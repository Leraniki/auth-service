# Сервис Авторизации на Spring Boot

Это полноценный сервис для регистрации и авторизации пользователей, построенный с использованием Spring Boot, Spring Security и JWT (JSON Web Tokens). Сервис реализует ролевую модель доступа и поддерживает жизненный цикл токенов, включая их обновление и отзыв.

## Ключевые возможности

*   **Регистрация пользователей:** Создание новых аккаунтов с уникальным логином и email.
*   **Аутентификация:** Вход существующих пользователей по логину и паролю.
*   **Ролевая модель:** Поддержка трех ролей: `ADMIN`, `PREMIUM_USER`, `GUEST`.
*   **Безопасность паролей:** Пароли хранятся в базе данных в зашифрованном виде (BCrypt).
*   **Аутентификация на основе токенов:** Используется связка Access Token + Refresh Token.
    *   **Access Token:** Короткоживущий токен для доступа к защищенным ресурсам.
    *   **Refresh Token:** Долгоживущий токен для получения новой пары токенов без повторного ввода пароля.
*   **Отзыв токенов:** Реализован механизм "черного списка" для немедленного прекращения действия токена (например, при выходе из системы).

## Стек технологий

*   **Java 17+**
*   **Spring Boot**
*   **Spring Security** — для аутентификации и авторизации.
*   **Spring Data JPA** — для работы с базой данных.
*   **Maven** — для сборки проекта и управления зависимостями.
*   **H2 Database** — встраиваемая in-memory база данных для разработки.
*   **JJWT (Java JWT)** — библиотека для создания и проверки JWT.
*   **Lombok** — для сокращения шаблонного кода.

## Установка и запуск

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/ВАШ_НИКНЕЙМ/auth-service.git
    cd auth-service
    ```
2.  **Соберите проект с помощью Maven:**
    ```bash
    mvn clean install
    ```
3.  **Запустите приложение:**
    *   Через Maven:
      ```bash
      mvn spring-boot:run
      ```
    *   Или запустите главный класс `AuthServiceApplication.java` из вашей IDE.

Сервер будет запущен на `http://localhost:8080`.

## Документация API

Все эндпоинты доступны по базовому пути `/api/auth`.

### 1. Регистрация нового пользователя

*   **URL:** `/signup`
*   **Метод:** `POST`
*   **Тело запроса (Request Body):**
    ```json
    {
        "login": "newuser",
        "email": "newuser@example.com",
        "password": "password123",
        "roles": ["PREMIUM_USER"]
    }
    ```
    *Поле `roles` является необязательным. Если его не указать, пользователю будет присвоена роль `GUEST`.*

*   **Ответ (Success 200 OK):**
    ```json
    {
        "accessToken": "...",
        "refreshToken": "..."
    }
    ```
*   **Ошибки:** `400 Bad Request`, если логин или email уже существуют.

### 2. Вход в систему (Аутентификация)

*   **URL:** `/signin`
*   **Метод:** `POST`
*   **Тело запроса (Request Body):**
    ```json
    {
        "login": "newuser",
        "password": "password123"
    }
    ```
*   **Ответ (Success 200 OK):**
    ```json
    {
        "accessToken": "...",
        "refreshToken": "..."
    }
    ```
*   **Ошибки:** `401 Unauthorized`, если неверный логин или пароль.

### 3. Обновление токена доступа

*   **URL:** `/refresh`
*   **Метод:** `POST`
*   **Тело запроса (Request Body):**
    ```json
    {
        "refreshToken": "ВАШ_REFRESH_ТОКЕН"
    }
    ```
*   **Ответ (Success 200 OK):**
    ```json
    {
        "accessToken": "НОВЫЙ_ACCESS_ТОКЕН",
        "refreshToken": "ВАШ_ПРЕЖНИЙ_REFRESH_ТОКЕН"
    }
    ```
*   **Ошибки:** `400 Bad Request`, если refresh-токен невалиден.

### 4. Выход из системы (Отзыв токена)

*   **URL:** `/logout`
*   **Метод:** `POST`
*   **Заголовки (Headers):**
    *   `Authorization`: `Bearer ВАШ_ACCESS_ТОКЕН`
*   **Ответ (Success 200 OK):**
    ```
    Successfully logged out
    ```
    *После этого запроса `accessToken` будет добавлен в черный список и станет недействительным.*

## Доступ к базе данных (H2 Console)

Для отладки и просмотра данных во время работы приложения можно использовать веб-консоль H2.

1.  Перейдите по адресу: `http://localhost:8080/h2-console`
2.  Введите следующие данные для подключения:
    *   **Driver Class:** `org.h2.Driver`
    *   **JDBC URL:** `jdbc:h2:mem:testdb` (если вы закрепили его в `application.properties`)
    *   **User Name:** `sa`
    *   **Password:** (оставьте поле пустым)
3.  Нажмите `Connect`.

## Конфигурация

Основные настройки находятся в файле `src/main/resources/application.properties`.
Здесь можно изменить:
*   Параметры подключения к базе данных.
*   Секретный ключ для JWT (`jwt.secret`).
*   Время жизни токенов (`jwt.access-token-expiration-ms`, `jwt.refresh-token-expiration-ms`).

**Важно:** В реальном (production) окружении не храните секретные ключи в файле конфигурации. Используйте переменные окружения или системы управления секретами (например, HashiCorp Vault).